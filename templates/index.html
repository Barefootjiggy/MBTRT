<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MBT Response Tool</title>
  <link rel="stylesheet" href="/static/style.css">
  <script>
    function estimateTokens() {
      const feedback = document.querySelector('textarea[name="manual_feedback"]').value;
      const model = document.getElementById('model').value;
      const wordCount = feedback.trim().split(/\s+/).length;
      const inputTokens = Math.round(wordCount * 1.3);
      const outputTokens = 250;
      const totalTokens = inputTokens + outputTokens;

      let inputCost = 0;
      let outputCost = 0;

      if (model === 'gpt-4') {
        inputCost = inputTokens / 1000 * 0.01;
        outputCost = outputTokens / 1000 * 0.03;
      } else {
        inputCost = inputTokens / 1000 * 0.0005;
        outputCost = outputTokens / 1000 * 0.0015;
      }

      const totalCost = inputCost + outputCost;

      document.getElementById("token-estimate").innerHTML =
        `Estimated Tokens: <strong>${totalTokens}</strong><br>
         Input: ${inputTokens} tokens ≈ $${inputCost.toFixed(4)}<br>
         Output: ${outputTokens} tokens ≈ $${outputCost.toFixed(4)}<br>
         <strong>Total ≈ $${totalCost.toFixed(4)} (${model})</strong>`;
    }
  </script>
  <style>
    .info-icon {
      cursor: pointer;
      border: none;
      background: none;
      font-size: 1.2em;
      margin-left: 4px;
    }
    .tooltip {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      padding: 6px;
      border: 1px solid #ccc;
      font-size: 0.9em;
      max-width: 300px;
    }
    .info-container:hover .tooltip {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MBT Response Tool</h1>
    <form method="POST" enctype="multipart/form-data" oninput="estimateTokens()">
      <label for="mode">Mode:</label>
      <select name="mode" id="mode">
        <option value="scrape">Login and Scrape</option>
        <option value="manual">Paste Manually</option>
      </select>

      <div id="scrape-fields">
        <input type="email" name="email" placeholder="Email">
        <input type="password" name="password" placeholder="Password">
      </div>

      <div id="manual-fields">
        <textarea name="manual_feedback" placeholder="Paste feedback here..."></textarea>
        <input type="file" name="image" accept="image/*">
      </div>

      <label for="model">AI Model:</label>
      <div class="info-container" style="display: inline-block; position: relative;">
        <select name="model" id="model">
          <option value="gpt-3.5-turbo">GPT-3.5 Turbo (faster, cheaper)</option>
          <option value="gpt-4">GPT-4 (more human, nuanced)</option>
        </select>
        <button type="button" class="info-icon">❓</button>
        <div class="tooltip">
          GPT-3.5 costs ~$0.0006/response<br>
          GPT-4 costs ~$0.014–0.015/response<br>
          Cost is based on input + output token usage.<br>
          1,000 tokens ≈ 750 words.
        </div>
      </div>

      <div id="token-estimate" style="margin-top: 8px; font-weight: bold;"></div>

      <button type="submit">Generate Responses</button>
    </form>

    {% if responses %}
      <h2>Results</h2>
      {% for item in responses %}
        <div class="response-block">
          <p><strong>Feedback:</strong> {{ item.feedback }}</p>
          <p><strong>Response:</strong> {{ item.response }}</p>
        </div>
      {% endfor %}
    {% endif %}
  </div>
</body>
</html>